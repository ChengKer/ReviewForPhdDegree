## 第六章 关系数据理论

1. 关系模式由5部分组成：`R(U,D,DOM,F)`，我们可以简化为一个三元组 `R(U,F)`

2. 数据依赖：定义属性值之间的相互关系（主要体现在值的相等与否）

   - 数据依赖的**类型**：
     - 函数依赖
     - 多值依赖

3. 函数依赖：设R(U)是一个属性集U上的关系式，X和Y是U的子集，如对于R(U)的任意一个可能的关系 `r`，`r` 中不可能存在两个元组在X上的属性相等，而在Y上的属性值不等，则称 `X函数确定Y` 或 `Y函数依赖于X`，记作 X→Y

   - **非平凡**函数依赖：若 X→Y，但 $Y\nsubseteq X$，则称 X→Y 是非平凡的函数依赖

   - **平凡**函数依赖：若 X→Y，但 $Y\subseteq X$，则称 X→Y 是平凡的函数依赖

   - **完全**函数依赖：如果 X→Y，并且对于X的任何一个子集 X'，都有 $X'\not \longrightarrow Y$，则称Y完全函数依赖于X，记作 $X\longrightarrow^F Y$

   - **部分**函数依赖：如果 X→Y，但Y并不完全依赖于X，则称Y对X部分函数依赖，记作 $X→^PY$

   - **传递**函数依赖：在R(U) 中，如果X→Y，$(Y\nsubseteq X),Y\not\longrightarrow X,Y\not\longrightarrow Z$ 则称 $X\longrightarrow^{依赖}Z$

     P.S. X→Y，如果 Y→X，Y→Z，则Z直接依赖于X

4. 候选码：设K为R(U,F)中的属性或集合。若 $K\longrightarrow^F U$，则称 K 为R的候选码，若候选码多于一个，则选定其中的一个作为主码
5. 主属性：包含在任何一个候选码中的属性称为主属性
6. 全码：整个属性组是候选码，称为全码
7. **范式**是属于某一级别的关系模式的集合，范式的种类及联系 $1NF\supset 2NF\supset 3NF \supset 4NF\supset 5NF$
8. 某一关系模式R为第n范式，可简单记作 $R\in nNF$
9. 规范化：一个低一级的关系模式，通过模式分解可以转换为若干个高一级范式的关系模式的集合，这种过程就叫做规范化
10. **1NF**：如果一个关系模式R的所有属性都是不可分的基本数据项，则 $R\in 1NF$
11. **2NF**：若 $R\in 1NF$，且每一个非主属性**完全函数依赖**于码，则 $R\in 2NF$
12. **3NF**：关系模式 R(U,F) 中不存在这样的码 X、属性组Y及非主属性 $Z(Z\nsubseteq Y)$，使得X→Y，Y→Z成立，$Y\not \longrightarrow X$，则称 $R(U,F)\in 3NF$，在2NF的基础上消除了非主属性与码之间的传递函数依赖
13. **BCNF**：关系模式 $R<U,F>\in 1NF$，若 X→Y 且 $Y\nsubseteq X$ 时X必含有码，则$R<U,F>\in BCNF$。等价于，每一个决定因素都包含码
    - 所有非主属性对每一个码都是完全函数依赖（3NF）
    - 所有的主属性对每一个不包含它的码，也是完全函数依赖（3NF没有这个限制）
    - 没有任何属性完全依赖于非码的任何一组属性
    - $R\in BCNF\longrightarrow R\in 3NF,R\in 3NF \not\longrightarrow R\in 3NF$
    - 若$R\in 3NF$ 且 R只有一个候选码那么R也属于**BCNF**
14. 多值依赖定义：设R(U)是一个属性集U上的一个关系模式，X、Y和Z是U的子集，并且 $Z=U-X-Y$，这种关系模式R(U)中多值依赖 $X\longrightarrow \longrightarrow Y$ 成立，当且仅当对R(U)的任一关系r，给定的对 (x,z)值，有一组Y的值，这组值仅仅决定于x值而与z无关
    - **等价定义**：在R(U)的任一关系r中，如果存在元组t，s使得 t[X]=s[X]，那么必然存在元组 $w,v\in r$(w,v可以与s,t相同)，使得 w[X]=v[X]=t[X]，w[Y]=t[Y]，w[Z]=s[Z]，v[Y]=s[Y]，v[Z]=t[Z]（即交换s，t元组的Y值所得的两个新元组必在r中），则Y多值依赖于，记为 X→→Y。这里X，Y是U的子集，Z=U-X-Y
    - 简单来说就是X和Y是一对多的关系，X和Z也是一对多的关系，Z和Y之间多对多，这样Y多值依赖X，Z也多值依赖X
    - 函数依赖和是多值依赖的特殊情况
      - 在定义中，`任取(x,z)，都有一组y...`，在函数依赖中，一组y，组中的元素个数为1
      - 在等价定义中：w,v 与 s,t 相同

15. 多值依赖与函数依赖的区别：

    - 多值依赖的有效性与属性集的范围有关：若 X→→Y，在U上成立，则在 $W(XY\subseteq W\subseteq U)$ 上一定成立。但 $X\longrightarrow\longrightarrow Y$，在 $W(W\sub U)$上成立，在U上并不一定成立。（这是因为多值依赖的定义中不仅涉及到X和Y，而且涉及到U中的其余属性Z）
    - 若函数依赖 X→Y在R(U)上成立，则对于任何 $Y'\subset Y$ 均有 $X\longrightarrow Y'$成立；多值依赖 X→→Y若在R(U)上成立，不能断言对于任何 $Y'\subset Y$ 都有X→→Y’成立

16. **4NF**：关系模式 $R<U,F>\in 1NF$，如果对于R的每个非平凡多值依赖 X→→Y($Y\nsubseteq$ X) 都含有码，则 $R\in 4NF$。

    如果 $R\in 4NF$，则 $R\in BCN F$

17. 规范化的目的：消除插入和删除异常，修改复杂和数据冗余，实质：概念的单一化

18. 关系模式规范化的基本步骤

    ```mermaid
    graph TB
    1NF((1NF))
    2NF((2NF))
    3NF((3NF))
    BCNF((BCNF))
    4NF((4NF))
    1NF-->|消除非主属性对码的部分函数依赖|2NF
    2NF-->|消除非主属性对码的传递函数依赖|3NF
    3NF-->|消除主属性对码的部分和传递函数依赖|BCNF
    BCNF-->|消除非平凡且非函数依赖的多值依赖|4NF
    ```

19. 对于满足一组函数依赖F的关系模式R<U,F>，**其任何一个关系r**，若函数依赖X→Y都成立，（即r中任意两元组t，s，若t[X]=s[X]，则t[Y]=s[Y]），则称F逻辑蕴含 X→Y

20. Armstrong 公理系统：

    - **自反率**：若 $Y\subseteq X\subseteq U$ ，则X→Y为F所蕴含
    - **增广率**：若 X→Y为F所蕴含，且 $Z\subseteq U$，则XZ→YZ为F所蕴含
    - **传递率**：若X→Y及Y→Z为F所蕴含，则X→Z为F所蕴含

21. 在关系模式 R<U,F>中为F所逻辑蕴含的函数依赖的全体叫做F的闭包，记为 $F^+$

22. 设F为属性集U上的一组函数依赖，$X\subseteq U,X_F^+=\{A|X\longrightarrow A能由F根据Armstrong公理导出\}$，$X_F^+$ 称为属性集**X关于函数依赖集F**的闭包

23. **引理6.2**：设F为属性集U上的一组函数依赖，$X,Y\subseteq U,X→Y能由F根据Armstrong公理导出的充分必要条件是 Y\subseteq X_F^+$

    用途：将判定X→Y是否能由F根据Armstrong公理导出的问题，转化为求出 $X_F^+$、判定Y是否为$X_F^+$ 的子集的问题

24. 求闭包的算法：求属性集X($X\subseteq U $) 关于U上的函数依赖集F的闭包 $X_F^+$

    输入：X，F

    步骤：

    - 令 $X^{(0)}=X,i=0$

    - 求B，这里 $B=\{A|(\exists W)(\exists V)(V\longrightarrow W\in F \wedge V\subseteq X^{(i)}\wedge A\in W\})\}$

      即对于F中的每一个函数依赖X→Y，如果X属于结果集，那么将Y中所有属性加入结果集

    - $X^{(i+1)}=B\bigcup X^{(i)}$

    - 若 $X^{(i+1)}= X^{(i)} 或者 X^{(i)}=U$，那么 $X^{(i)}$ 就是 $X_F^+$

    - 否则，i=i+1，返回第2步

    P.S. $MAX(|X_F^+|)=|U|$，因此算法最多运行|U|-|X|次就会终止

25. 定义 6.14 如果$G^+=F^+$，就说函数依赖集F覆盖G(F是G的覆盖或G是F的覆盖)，或F与G等价
26. 引理 6.3 $F^+=G^+$的充要条件是 $F\subseteq G^+,且 G\subseteq F^+$
27. 模式分解的标准：三种模式分解等价的定义：
    - 分解具有无损连接性
    - 分解要保持依赖
    - 分解既要保持依赖，又要无损连接性
28. **无损连接分解**：若分解过后的关系可以通过**自然连接**恢复为原来的关系，则这种分解就没有丢失信息。R分解为R1和R2是无损连接分解，当且仅当下列依赖中的至少一个属于 $F^+$：$R1\bigcap R2\longrightarrow R1,R1\bigcap R2\longrightarrow R2$，即分解后两个子模式的共同属性必须是R1或R2的码(适用于**1分为2的分解**)
29. 分解是**保持函数依赖**的：设关系R(U,F)被分解为若干关系模式，若F所蕴含的函数依赖一定也由分解得到的某个关系模式中的函数依赖 $F_i$ 所蕴含，则称关系模式R的这个分解是保持依赖的
30. 若要求分解具有无损连接性，那么模式分解一定可以达到4NF。若分解要求保持函数依赖，那么模式分解一定能够达到3NF，但不一定能够达到BCNF，若要求分解既具有无损连接性，又保持函数依赖，则模式分解一定能够达到3NF，但不一定能够达到BCNF







